#!/usr/bin/env ruby

#Load our libraries, if we can't load them from the gem, assume we're running from source
require 'rubygems'
require 'rmybackup'
require 'optparse'

#GLOBALS
#Default to local config file if it exists
if File.exists?(File.expand_path("~/.rmybackup.conf"))
  options = { :config_file => File.expand_path("~/.rmybackup.conf") }
else
  options = { :config_file => "/etc/rmybackup.conf" }
end

gem_version = RMyBackup::GEM_VERSION

#Process the command line arguments
ARGV.options do |opts|
  #Set the config file
  opts.on("-f /etc/rmybackup.conf","--config-file /etc/rmybackup.conf","Set Config File",String) do |o| 
    options[:config_file] = o 
  end
  
  #Version
  opts.on("-v","--version","Outputs version") { puts "Version - #{gem_version}"; exit }

  #Allow the user to write the sample config file to either the default (no file specified) or to the file they specify
  #on the command line
  opts.on("-i [config_file location]","--install-config [config_file location]","Generates a sample config file",String) do |ic|
    RMyBackup.install_config(ic)
    exit 0
  end
  
  opts.parse!
end

#If the config file doesn't exist, warn and exit
if not File.exists? options[:config_file]
  puts "Unable to read the configuration file - #{options[:config_file]}"
  exit
end

#Run
RMyBackup::Base.new(options[:config_file])
