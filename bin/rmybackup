#!/usr/bin/env ruby

#Load our libraries, if we can't load them from the gem, assume we're running from source
begin
  require 'rubygems'
  require 'rmybackup'
rescue LoadError
  require '../lib/rmybackup'
end

require 'optparse'

#Set some globals
OPTIONS = { :config_file => "/etc/rmybackup.conf" }
GEM_VERSION = "0.0.3"

#Process the command line arguments
ARGV.options do |opts|
  opts.on("-f /etc/rmybackup.conf","--config_file /etc/rmybackup.conf","Set Config File",String) { |OPTIONS[:config_file]| }
  opts.on("-v","--version","Outputs version") { puts "Version - #{GEM_VERSION}"; exit }
  opts.on("-i [config_file location]","--install_config [config_file location]",String) do |ic|
    puts "Install it #{ic}"
    exit 0
  end
  opts.parse!
end

#If the config file doesn't exist, warn and exit
if not File.exists? OPTIONS[:config_file]
  puts "Unable to read the configuration file - #{OPTIONS[:config_file]}"
  exit
end

#Run
RMyBackup.new(OPTIONS[:config_file])